theme(legend.position = "none") + geom_text(aes(label = team), hjust = 0, vjust = 0)
theme_set(theme_tufte())
filter(scores2, simulatedR <= 64) %>% ggplot(aes(x = OFFENSE, y = DEFENSE)) +
theme(legend.position = "none") + geom_text(aes(label = team), hjust = 0, vjust = 0)
filter(scores2, simulatedR <= 64) %>% ggplot(aes(x = OFFENSE, y = DEFENSE)) +
theme(legend.position = "none") + geom_text(aes(label = team), hjust = 1, vjust = 2)
filter(scores2, simulatedR <= 64) %>% ggplot(aes(x = OFFENSE, y = DEFENSE)) +
theme(legend.position = "none") + geom_text(aes(label = team), hjust = 0, vjust = 2)
filter(scores2, simulatedR <= 64) %>% ggplot(aes(x = OFFENSE, y = DEFENSE)) +
theme(legend.position = "none") + geom_text(aes(label = team), hjust = 2, vjust = 1)
filter(scores2, simulatedR <= 64) %>% ggplot(aes(x = OFFENSE, y = DEFENSE)) +
theme(legend.position = "none") + geom_text(aes(label = team), hjust = 5, vjust = 5)
filter(scores2, simulatedR <= 64) %>% ggplot(aes(x = OFFENSE, y = DEFENSE)) +
theme(legend.position = "none") + geom_text(aes(label = team), hjust = -5, vjust = -5)
ggplot(scores2, aes(V2, simulated)) +
geom_tufteboxplot() + theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
labs(title = "Scores by Conference",
caption = "Source: EWS",
x = "",
y = "Simulated Score")
ggplot(scores2, aes(V2, simulated)) +
geom_tufteboxplot() + theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
labs(title = "NCAA Conferences",
caption = "Source: EWS",
x = "",
y = "Simulated Metric")
filter(scores2, simulatedR <= 68)
filter(scores2, simulatedR <= 68) %>% tally(V2)
filter(scores2, simulatedR <= 68) %>% group_by(V2) %>% tally(V2)
filter(scores2, simulatedR <= 68) %>% group_by(V2) %>% count(V2)
filter(scores2, simulatedR <= 68) %>% group_by(V2) %>% count(V2, sort = TRUE)
## Created by: Eric William Shannon, PhD
## Date modified: 20190202
require(tidyverse)
require(ggplot2)
require(ggthemes)
require(psych)
data2 <- openxlsx::read.xlsx("../data/20190206.xlsx", colNames = TRUE, startRow = 2)
data2 <- data2[, -1]
conf <- read.csv("../data/teams.csv", header = FALSE)
rownames(data2) <- data2[, 1]
data2 <- data2[, -1]
rownames(data2) <- gsub("NCAA", "", rownames(data2))
data2 <- data2[(complete.cases(data2)), ]
data2 <- janitor::clean_names(data2)
offense_data <- offense_data %>% select(tm, pace, o_rtg, f_tr, x3p_ar, ts_percent, trb_percent, ast_percent, e_fg_percent, ft_fga)
offense_data <- data2 %>% select(tm, pace, o_rtg, f_tr, x3p_ar, ts_percent, trb_percent, ast_percent, e_fg_percent, ft_fga)
defense_data <- data2 %>% select(stl_percent, blk_percent, tov_percent, orb_percent)
pr_offense <- principal(offense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_offense <- as.data.frame(pr_offense$scores)
names(pr_offense)[names(pr_offense) == "PC1"] <- "OFFENSE"
defense_data <- data2 %>% select(stl_percent, blk_percent, tov_percent, orb_percent)
pr_defense <- principal(defense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_defense <- as.data.frame(pr_defense$scores)
names(pr_defense)[names(pr_defense) == "PC1"] <- "DEFENSE"
scores2 <- as.data.frame(cbind(data2, pr_offense, pr_defense))
scores2 <- scores2 %>% select(srs, w_l_percent, g, sos, OFFENSE, DEFENSE)
scores2 <- scores2 %>% rownames_to_column('V1')
scores2$V1 <- sub("^\\s+", "", scores2$V1)
scores2$V1 <- gsub("(^\\s+)|(\\s+$)", "", scores2$V1)
conf$V1 <- as.character(conf$V1)
conf$V1 <- sub("^\\s+", "", conf$V1)
conf$V1 <- gsub("(^\\s+)|(\\s+$)", "", conf$V1)
View(conf)
View(scores2)
scores2 <- scores2 %>% left_join(conf)
View(scores2)
conference_effect <- lme4::lmer(srs ~ sos + w_l_percent + DEFENSE + OFFENSE + (1 | V2), data = scores2)
scores2$simulated <- simulate(conference_effect, seed = 1, newdata = scores2, allow.new.levels = TRUE, re.form = NA, cond.sim = FALSE)$sim_1
scores2 <- scores2 %>% select(V1, V2, OFFENSE, DEFENSE, simulated)
View(scores2)
scores2 <- scores2 %>%
mutate(simulatedR = dense_rank(desc(simulated))) %>%
column_to_rownames('V1')
scores2 <- scores2 %>%
rownames_to_column('team')
scores2$simulated <- scale(scores2$simulated)
scores2 <-
scores2 %>% mutate_at(vars(OFFENSE, DEFENSE, simulated), funs(round(. , 4)))
View(scores2)
View(scores2)
?bind_cols
## Created by: Eric William Shannon, PhD
## Date modified: 20190202
require(tidyverse)
require(ggplot2)
require(ggthemes)
require(psych)
data2 <- openxlsx::read.xlsx("../data/20190206.xlsx", colNames = TRUE, startRow = 2)
data2 <- data2[, -1]
conf <- read.csv("../data/teams.csv", header = FALSE)
rownames(data2) <- data2[, 1]
data2 <- data2[, -1]
rownames(data2) <- gsub("NCAA", "", rownames(data2))
data2 <- data2[(complete.cases(data2)), ]
data2 <- janitor::clean_names(data2)
offense_data <- data2 %>% select(tm, pace, o_rtg, f_tr, x3p_ar, ts_percent, trb_percent, ast_percent, e_fg_percent, ft_fga)
pr_offense <- principal(offense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_offense <- as.data.frame(pr_offense$scores)
names(pr_offense)[names(pr_offense) == "PC1"] <- "OFFENSE"
defense_data <- data2 %>% select(stl_percent, blk_percent, tov_percent, orb_percent)
pr_defense <- principal(defense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_defense <- as.data.frame(pr_defense$scores)
names(pr_defense)[names(pr_defense) == "PC1"] <- "DEFENSE"
scores2 <- bind_cols(data2, pr_offense, pr_defense)
scores2 <- scores2 %>% select(srs, w_l_percent, g, sos, OFFENSE, DEFENSE)
scores2 <- scores2 %>% rownames_to_column('V1')
scores2$V1 <- sub("^\\s+", "", scores2$V1)
scores2$V1 <- gsub("(^\\s+)|(\\s+$)", "", scores2$V1)
conf$V1 <- as.character(conf$V1)
conf$V1 <- sub("^\\s+", "", conf$V1)
conf$V1 <- gsub("(^\\s+)|(\\s+$)", "", conf$V1)
scores2 <- scores2 %>% left_join(conf)
conference_effect <- lme4::lmer(srs ~ sos + w_l_percent + DEFENSE + OFFENSE + (1 | V2), data = scores2)
## Created by: Eric William Shannon, PhD
## Date modified: 20190202
require(tidyverse)
require(ggplot2)
require(ggthemes)
require(psych)
data2 <- openxlsx::read.xlsx("../data/20190206.xlsx", colNames = TRUE, startRow = 2)
data2 <- data2[, -1]
conf <- read.csv("../data/teams.csv", header = FALSE)
rownames(data2) <- data2[, 1]
data2 <- data2[, -1]
rownames(data2) <- gsub("NCAA", "", rownames(data2))
data2 <- data2[(complete.cases(data2)), ]
data2 <- janitor::clean_names(data2)
offense_data <- data2 %>% select(tm, pace, o_rtg, f_tr, x3p_ar, ts_percent, trb_percent, ast_percent, e_fg_percent, ft_fga)
pr_offense <- principal(offense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_offense <- as.data.frame(pr_offense$scores)
names(pr_offense)[names(pr_offense) == "PC1"] <- "OFFENSE"
defense_data <- data2 %>% select(stl_percent, blk_percent, tov_percent, orb_percent)
pr_defense <- principal(defense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_defense <- as.data.frame(pr_defense$scores)
names(pr_defense)[names(pr_defense) == "PC1"] <- "DEFENSE"
scores2 <- bind_cols(data2, pr_offense, pr_defense)
scores2 <- scores2 %>% select(srs, w_l_percent, g, sos, OFFENSE, DEFENSE)
scores2 <- scores2 %>% rownames_to_column('V1')
scores2$V1 <- sub("^\\s+", "", scores2$V1)
scores2$V1 <- gsub("(^\\s+)|(\\s+$)", "", scores2$V1)
conf$V1 <- as.character(conf$V1)
conf$V1 <- sub("^\\s+", "", conf$V1)
conf$V1 <- gsub("(^\\s+)|(\\s+$)", "", conf$V1)
scores2 <- scores2 %>% left_join(conf)
View(scores2)
## Created by: Eric William Shannon, PhD
## Date modified: 20190202
require(tidyverse)
require(ggplot2)
require(ggthemes)
require(psych)
data2 <- openxlsx::read.xlsx("../data/20190206.xlsx", colNames = TRUE, startRow = 2)
data2 <- data2[, -1]
conf <- read.csv("../data/teams.csv", header = FALSE)
rownames(data2) <- data2[, 1]
data2 <- data2[, -1]
rownames(data2) <- gsub("NCAA", "", rownames(data2))
data2 <- data2[(complete.cases(data2)), ]
data2 <- janitor::clean_names(data2)
offense_data <- data2 %>% select(tm, pace, o_rtg, f_tr, x3p_ar, ts_percent, trb_percent, ast_percent, e_fg_percent, ft_fga)
pr_offense <- principal(offense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_offense <- as.data.frame(pr_offense$scores)
names(pr_offense)[names(pr_offense) == "PC1"] <- "OFFENSE"
defense_data <- data2 %>% select(stl_percent, blk_percent, tov_percent, orb_percent)
pr_defense <- principal(defense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_defense <- as.data.frame(pr_defense$scores)
names(pr_defense)[names(pr_defense) == "PC1"] <- "DEFENSE"
scores2 <- as.data.frame(bind_cols(data2, pr_offense, pr_defense))
scores2 <- scores2 %>% select(srs, w_l_percent, g, sos, OFFENSE, DEFENSE)
scores2 <- scores2 %>% rownames_to_column('V1')
View(scores2)
## Created by: Eric William Shannon, PhD
## Date modified: 20190202
require(tidyverse)
require(ggplot2)
require(ggthemes)
require(psych)
data2 <- openxlsx::read.xlsx("../data/20190206.xlsx", colNames = TRUE, startRow = 2)
data2 <- data2[, -1]
conf <- read.csv("../data/teams.csv", header = FALSE)
rownames(data2) <- data2[, 1]
data2 <- data2[, -1]
rownames(data2) <- gsub("NCAA", "", rownames(data2))
data2 <- data2[(complete.cases(data2)), ]
data2 <- janitor::clean_names(data2)
offense_data <- data2 %>% select(tm, pace, o_rtg, f_tr, x3p_ar, ts_percent, trb_percent, ast_percent, e_fg_percent, ft_fga)
pr_offense <- principal(offense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_offense <- as.data.frame(pr_offense$scores)
names(pr_offense)[names(pr_offense) == "PC1"] <- "OFFENSE"
defense_data <- data2 %>% select(stl_percent, blk_percent, tov_percent, orb_percent)
pr_defense <- principal(defense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_defense <- as.data.frame(pr_defense$scores)
names(pr_defense)[names(pr_defense) == "PC1"] <- "DEFENSE"
scores2 <- as.data.frame(cbind(data2, pr_offense, pr_defense))
scores2 <- scores2 %>% select(srs, w_l_percent, g, sos, OFFENSE, DEFENSE)
scores2 <- scores2 %>% rownames_to_column('V1')
View(scores2)
scores2$V1 <- sub("^\\s+", "", scores2$V1)
scores2$V1 <- gsub("(^\\s+)|(\\s+$)", "", scores2$V1)
conf$V1 <- as.character(conf$V1)
conf$V1 <- sub("^\\s+", "", conf$V1)
conf$V1 <- gsub("(^\\s+)|(\\s+$)", "", conf$V1)
scores2 <- scores2 %>% left_join(conf)
conference_effect <- lme4::lmer(srs ~ sos + w_l_percent + DEFENSE + OFFENSE + (1 | V2), data = scores2)
scores2$simulated <- simulate(conference_effect, seed = 1, newdata = scores2, allow.new.levels = TRUE, re.form = NA, cond.sim = FALSE)$sim_1
scores2 <- scores2 %>% select(V1, V2, OFFENSE, DEFENSE, simulated)
scores2 <- scores2 %>%
mutate(simulatedR = dense_rank(desc(simulated))) %>%
column_to_rownames('V1')
scores2 <- scores2 %>%
rownames_to_column('team')
scores2$simulated <- scale(scores2$simulated)
scores2 <-
scores2 %>% mutate_at(vars(OFFENSE, DEFENSE, simulated), funs(round(. , 4)))
View(scores2)
View(scores2)
scores2 %>% group_by(V2) %>% mutate(conferenceR = dense_rank(desc(simulated)))
theme_set(theme_tufte())
ggplot(scores2, aes(V2, simulated)) +
geom_tufteboxplot() + theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
labs(title = "NCAA Conferences",
caption = "Source: EWS",
x = "",
y = "Simulated Metric")
scores2 %>% filter(simulatedR <= 68) %>% ggplot(aes(OFFENSE, DEFENSE)) + geom_text(aes(label = team), check_overlap = TRUE)
View(scores2)
scores2 %>% filter(simulatedR <= 68) %>% ggplot(aes(simulated)) + geom_text(aes(label = team), check_overlap = TRUE)
scores2 %>% filter(simulatedR <= 68) %>% ggplot(aes(simulated, DEFENSE)) + geom_text(aes(label = team), check_overlap = TRUE)
scores2 %>% filter(simulatedR <= 68) %>% ggplot(aes(simulated, simulatedR)) + geom_text(aes(label = team), check_overlap = TRUE)
scores2 %>% filter(simulatedR <= 68) %>% ggplot(aes(simulatedR, simulated)) + geom_text(aes(label = team), check_overlap = TRUE)
## Created by: Eric William Shannon, PhD
## Date modified: 20190209
require(tidyverse)
require(ggplot2)
require(ggthemes)
require(psych)
data2 <- openxlsx::read.xlsx("../data/20190209.xlsx", colNames = TRUE, startRow = 2)
data2 <- data2[, -1]
conf <- read.csv("../data/teams.csv", header = FALSE)
rownames(data2) <- data2[, 1]
data2 <- data2[, -1]
rownames(data2) <- gsub("NCAA", "", rownames(data2))
data2 <- data2[(complete.cases(data2)), ]
data2 <- janitor::clean_names(data2)
offense_data <- data2 %>%
select(tm, pace, o_rtg, f_tr, x3p_ar, ts_percent, trb_percent, ast_percent, e_fg_percent, ft_fga)
pr_offense <- principal(offense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
names(pr_offense)[names(pr_offense) == "PC1"] <- "OFFENSE"
defense_data <- data2 %>% select(stl_percent, blk_percent, tov_percent, orb_percent)
pr_defense <- principal(defense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_defense <- as.data.frame(pr_defense$scores)
names(pr_defense)[names(pr_defense) == "PC1"] <- "DEFENSE"
scores2 <- as.data.frame(cbind(data2, pr_offense, pr_defense))
scores2 <- scores2 %>% select(srs, w_l_percent, g, sos, OFFENSE, DEFENSE)
scores2 <- scores2 %>% rownames_to_column('V1')
scores2$V1 <- sub("^\\s+", "", scores2$V1)
scores2$V1 <- gsub("(^\\s+)|(\\s+$)", "", scores2$V1)
## Created by: Eric William Shannon, PhD
## Date modified: 20190209
require(tidyverse)
require(ggplot2)
require(ggthemes)
require(psych)
data2 <- openxlsx::read.xlsx("../data/20190209.xlsx", colNames = TRUE, startRow = 2)
data2 <- data2[, -1]
conf <- read.csv("../data/teams.csv", header = FALSE)
rownames(data2) <- data2[, 1]
data2 <- data2[, -1]
rownames(data2) <- gsub("NCAA", "", rownames(data2))
data2 <- data2[(complete.cases(data2)), ]
data2 <- janitor::clean_names(data2)
offense_data <- data2 %>%
select(tm, pace, o_rtg, f_tr, x3p_ar, ts_percent, trb_percent, ast_percent, e_fg_percent, ft_fga)
pr_offense <- principal(offense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_offense <- as.data.frame(pr_offense$scores)
names(pr_offense)[names(pr_offense) == "PC1"] <- "OFFENSE"
defense_data <- data2 %>% select(stl_percent, blk_percent, tov_percent, orb_percent)
pr_defense <- principal(defense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_defense <- as.data.frame(pr_defense$scores)
names(pr_defense)[names(pr_defense) == "PC1"] <- "DEFENSE"
scores2 <- as.data.frame(cbind(data2, pr_offense, pr_defense))
scores2 <- scores2 %>% select(srs, w_l_percent, g, sos, OFFENSE, DEFENSE)
scores2 <- scores2 %>% rownames_to_column('V1')
scores2$V1 <- sub("^\\s+", "", scores2$V1)
scores2$V1 <- gsub("(^\\s+)|(\\s+$)", "", scores2$V1)
conf$V1 <- as.character(conf$V1)
conf$V1 <- sub("^\\s+", "", conf$V1)
conf$V1 <- gsub("(^\\s+)|(\\s+$)", "", conf$V1)
scores2 <- scores2 %>% left_join(conf)
conference_effect <- lme4::lmer(srs ~ sos + w_l_percent + DEFENSE + OFFENSE + (1 | V2),
data = scores2)
View(conference_effect)
?lme4
hist(scores2$srs)
conference_effect <- lme4::lmer(srs ~ sos + w_l_percent + DEFENSE + OFFENSE + (0 | V2),
data = scores2)
require(rstanarm)
stan_lmer(srs ~ sos + w_l_percent + DEFENSE + OFFENSE + (1 | V2),
data =scores2)
zed <- posterior_predict(fm_stan)
fm_stan <- stan_lmer(srs ~ sos + w_l_percent + DEFENSE + OFFENSE + (1 | V2),
data =scores2)
zed <- posterior_predict(fm_stan)
zed
View(zed)
?posterior_predict
zed <- posterior_predict(fm_stan, newdata = scores2)
View(zed)
require(tidyverse)
require(ggplot2)
require(ggthemes)
require(psych)
data2 <- openxlsx::read.xlsx("../data/20190215.xlsx", colNames = TRUE, startRow = 2)
data2 <- data2[, -1]
conf <- read.csv("../data/teams.csv", header = FALSE)
rownames(data2) <- data2[, 1]
data2 <- data2[, -1]
rownames(data2) <- gsub("NCAA", "", rownames(data2))
data2 <- data2[(complete.cases(data2)), ]
data2 <- janitor::clean_names(data2)
offense_data <- data2 %>%
select(tm, pace, o_rtg, f_tr, x3p_ar, ts_percent, trb_percent, ast_percent, e_fg_percent, ft_fga)
pr_offense <- principal(offense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_offense <- as.data.frame(pr_offense$scores)
names(pr_offense)[names(pr_offense) == "PC1"] <- "OFFENSE"
defense_data <- data2 %>% select(stl_percent, blk_percent, tov_percent, orb_percent)
pr_defense <- principal(defense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_defense <- as.data.frame(pr_defense$scores)
names(pr_defense)[names(pr_defense) == "PC1"] <- "DEFENSE"
scores2 <- as.data.frame(cbind(data2, pr_offense, pr_defense))
scores2 <- scores2 %>% select(srs, w_l_percent, g, sos, OFFENSE, DEFENSE)
scores2 <- scores2 %>% rownames_to_column('V1')
scores2$V1 <- sub("^\\s+", "", scores2$V1)
scores2$V1 <- gsub("(^\\s+)|(\\s+$)", "", scores2$V1)
conf$V1 <- as.character(conf$V1)
conf$V1 <- sub("^\\s+", "", conf$V1)
conf$V1 <- gsub("(^\\s+)|(\\s+$)", "", conf$V1)
scores2 <- scores2 %>% left_join(conf)
conference_effect <- lme4::lmer(srs ~ sos + w_l_percent + DEFENSE + OFFENSE + (1 | V2),
data = scores2)
scores2$simulated <- simulate(conference_effect, seed = 1, newdata = scores2,
allow.new.levels = TRUE, re.form = NA, cond.sim = FALSE)$sim_1
scores2 <- scores2 %>% select(V1, V2, OFFENSE, DEFENSE, simulated)
scores2 <- scores2 %>%
mutate(simulatedR = dense_rank(desc(simulated))) %>%
column_to_rownames('V1')
scores2 <- scores2 %>%
rownames_to_column('team')
scores2$simulated <- scale(scores2$simulated)
scores2 <-
scores2 %>% mutate_at(vars(OFFENSE, DEFENSE, simulated), funs(round(. , 3)))
scores2 %>% group_by(V2) %>% filter(max(simulated))
scores2 %>% group_by(V2) %>% filter(simulated = max(simulated))
scores2 %>% group_by(V2) %>% top_n(1, simulated)
champs <- scores2 %>%
group_by(V2) %>% top_n(1, simulated)
print(champs$team)
length(unique(champs$team))
68-33
`%!in%` <- negate(`%in%`)
at_large <- scores2 %>% filter(team %!in% champs$team) %>%
top_n(35, simulated)
View(at_large)
ncaa_predicts <- bind_rows(champs, at_large)
View(ncaa_predicts)
ncaa_predicts %>% group_by(V2) %>% count(V2, sort = TRUE)
## Created by: Eric William Shannon, PhD
## Date modified: 20190303
require(tidyverse)
require(ggplot2)
require(ggthemes)
require(psych)
`%!in%` <- negate(`%in%`)
data2 <- openxlsx::read.xlsx("../data/20190303.xlsx", colNames = TRUE, startRow = 2)
data2 <- data2[, -1]
conf <- read.csv("../data/teams.csv", header = FALSE)
rownames(data2) <- data2[, 1]
data2 <- data2[, -1]
rownames(data2) <- gsub("NCAA", "", rownames(data2))
data2 <- data2[(complete.cases(data2)), ]
data2 <- janitor::clean_names(data2)
offense_data <- data2 %>%
select(tm, pace, o_rtg, f_tr, x3p_ar, ts_percent, trb_percent, ast_percent, e_fg_percent, ft_fga)
pr_offense <- principal(offense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_offense <- as.data.frame(pr_offense$scores)
names(pr_offense)[names(pr_offense) == "PC1"] <- "OFFENSE"
defense_data <- data2 %>% select(stl_percent, blk_percent, tov_percent, orb_percent)
pr_defense <- principal(defense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_defense <- as.data.frame(pr_defense$scores)
names(pr_defense)[names(pr_defense) == "PC1"] <- "DEFENSE"
scores2 <- as.data.frame(cbind(data2, pr_offense, pr_defense))
scores2 <- scores2 %>% select(srs, w_l_percent, g, sos, OFFENSE, DEFENSE)
scores2 <- scores2 %>% rownames_to_column('V1')
scores2$V1 <- sub("^\\s+", "", scores2$V1)
scores2$V1 <- gsub("(^\\s+)|(\\s+$)", "", scores2$V1)
conf$V1 <- as.character(conf$V1)
conf$V1 <- sub("^\\s+", "", conf$V1)
conf$V1 <- gsub("(^\\s+)|(\\s+$)", "", conf$V1)
scores2 <- scores2 %>% left_join(conf)
conference_effect <- lme4::lmer(srs ~ sos + w_l_percent + DEFENSE + OFFENSE + (1 | V2),
data = scores2)
scores2$simulated <- simulate(conference_effect, seed = 1, newdata = scores2,
allow.new.levels = TRUE, re.form = NA, cond.sim = FALSE)$sim_1
scores2 <- scores2 %>% select(V1, V2, OFFENSE, DEFENSE, simulated)
scores2 <- scores2 %>%
mutate(simulatedR = dense_rank(desc(simulated))) %>%
column_to_rownames('V1')
scores2 <- scores2 %>%
rownames_to_column('team')
scores2$simulated <- scale(scores2$simulated)
scores2 <-
scores2 %>% mutate_at(vars(OFFENSE, DEFENSE, simulated), funs(round(. , 3)))
setwd("..")
openxlsx::write.xlsx(scores2, file = "ncaa_bracket/teams.xlsx")
rsconnect::deployApp("ncaa_bracket")
ggplot(scores2, aes(V2, simulated)) +
geom_boxplot() + theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
labs(title = "NCAA Conferences",
caption = "Source: EWS",
x = "",
y = "Simulated Metric") + scale_color_fivethirtyeight() +
theme_fivethirtyeight() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
champs <- scores2 %>%
group_by(V2) %>% top_n(1, simulated)
at_large <- scores2 %>% filter(team %!in% champs$team) %>%
top_n(35, simulated)
ncaa_predicts <- bind_rows(champs, at_large)
ncaa_predicts %>% group_by(V2) %>% count(V2, sort = TRUE)
View(ncaa_predicts)
ggplot(ncaa_predicts, aes(simulated)) +
geom_density() + theme_fivethirtyeight()
ggplot(ncaa_predicts, aes(simulated)) +
geom_text(aes(label = "team")) + theme_fivethirtyeight()
ggplot(ncaa_predicts, aes(simulatedR, simulated)) +
geom_text(aes(label = "team")) + theme_fivethirtyeight()
ggplot(ncaa_predicts, aes(simulatedR, simulated)) +
geom_text(aes(label = team)) + theme_fivethirtyeight()
ggplot(ncaa_predicts, aes(simulatedR, simulated)) +
geom_text(aes(label = team), check_overlap = TRUE) + theme_fivethirtyeight()
ggplot(ncaa_predicts, aes(OFFENSE, DEFENSE)) +
geom_text(aes(label = team), check_overlap = TRUE) + theme_fivethirtyeight()
?ggplot
ggplot(ncaa_predicts, aes(team, simulated)) +
geom_bar(stat = "identity", aes(fill = team), legend = FALSE)
## Created by: Eric William Shannon, PhD
## Date modified: 20190303
require(tidyverse)
require(ggplot2)
require(ggthemes)
require(psych)
`%!in%` <- negate(`%in%`)
data2 <- openxlsx::read.xlsx("../data/20190303.xlsx", colNames = TRUE, startRow = 2)
data2 <- data2[, -1]
conf <- read.csv("../data/teams.csv", header = FALSE)
rownames(data2) <- data2[, 1]
data2 <- data2[, -1]
rownames(data2) <- gsub("NCAA", "", rownames(data2))
data2 <- data2[(complete.cases(data2)), ]
data2 <- janitor::clean_names(data2)
offense_data <- data2 %>%
select(tm, pace, o_rtg, f_tr, x3p_ar, ts_percent, trb_percent, ast_percent, e_fg_percent, ft_fga)
pr_offense <- principal(offense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_offense <- as.data.frame(pr_offense$scores)
names(pr_offense)[names(pr_offense) == "PC1"] <- "OFFENSE"
defense_data <- data2 %>% select(stl_percent, blk_percent, tov_percent, orb_percent)
pr_defense <- principal(defense_data, nfactors = 1, rotate = "varimax",
scores = TRUE, oblique.scores = FALSE, covar = TRUE)
pr_defense <- as.data.frame(pr_defense$scores)
names(pr_defense)[names(pr_defense) == "PC1"] <- "DEFENSE"
scores2 <- as.data.frame(cbind(data2, pr_offense, pr_defense))
scores2 <- scores2 %>% select(srs, w_l_percent, g, sos, OFFENSE, DEFENSE)
scores2 <- scores2 %>% rownames_to_column('V1')
scores2$V1 <- sub("^\\s+", "", scores2$V1)
scores2$V1 <- gsub("(^\\s+)|(\\s+$)", "", scores2$V1)
conf$V1 <- as.character(conf$V1)
conf$V1 <- sub("^\\s+", "", conf$V1)
conf$V1 <- gsub("(^\\s+)|(\\s+$)", "", conf$V1)
scores2 <- scores2 %>% left_join(conf)
conference_effect <- lme4::lmer(srs ~ sos + w_l_percent + DEFENSE + OFFENSE + (1 | V2),
data = scores2)
scores2$simulated <- simulate(conference_effect, seed = 1, newdata = scores2,
allow.new.levels = TRUE, re.form = NA, cond.sim = FALSE)$sim_1
scores2 <- scores2 %>% select(V1, V2, OFFENSE, DEFENSE, simulated)
scores2 <- scores2 %>%
mutate(simulatedR = dense_rank(desc(simulated))) %>%
column_to_rownames('V1')
scores2 <- scores2 %>%
rownames_to_column('team')
scores2$simulated <- scale(scores2$simulated)
scores2 <-
scores2 %>% mutate_at(vars(OFFENSE, DEFENSE, simulated), funs(round(. , 3)))
